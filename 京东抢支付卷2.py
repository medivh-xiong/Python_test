import requests
import time
import datetime


cookies = {
    'thor': '692282AD7BA1C94C0971A78264E0B754E57A34F0BEC7E4CB14433D1E1206EA71A0237FBC576C54B03A2E64F85E7C67772F10C694BF81CA1026894313910A87E8D4DABA5AD8D8F2CB2B8BE46EFB247363D9EA46F5E76777CE917E8235F8349D5C348A4667581BC1C565864C899174B201078E66E1905F01096FC59878E9C1F364774C3A17D20691AC36126171FA934A5EE257BA6DBFF47599402BD28554E5A2B3'
}

headers = {
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:123.0) Gecko/20100101 Firefox/123.0',
    'Accept': '*/*',
    'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',
    # 'Accept-Encoding': 'gzip, deflate, br',
    'Referer': 'https://pro.jd.com/mall/active/3Mj3aSzeiRVGiV4HptYgFJvee5xA/index.html?babelChannel=ttt57',
    'Content-Type': 'application/x-www-form-urlencoded',
    'x-referer-page': 'https://pro.jd.com/mall/active/3Mj3aSzeiRVGiV4HptYgFJvee5xA/index.html',
    'x-rp-client': 'h5_1.0.0',
    'Origin': 'https://pro.jd.com',
    'Connection': 'keep-alive',
    # 'Cookie': '__jda=70901841.1668069089029464342293.1668069089.1710726960.1710812442.279; b_dw=1905; b_dh=927; b_dpr=2; b_webp=1; b_avif=1; shshshfpb=BApXen-VWV-tA5kVcheQqbPiQ8NWkO6NcBypHl75X9xJ1MhsrroO2; shshshfp=b6ec8c37a67e0e37fd7f25ffacb1dc2b; shshshfpa=3910eb4c-77a3-c4d8-4a59-99a21ffd1286-1668069091; jcap_dvzw_fp=MStjxvc74o8PNBQNWwvkqMy4UUC2oFU3mziJBO7xwNEc-qWJfCkVnJtoSp00zaKo8Gu2BA==; __jdu=1668069089029464342293; shshshfpx=3910eb4c-77a3-c4d8-4a59-99a21ffd1286-1668069091; 3AB9D23F7A4B3CSS=jdd037XZ4KFNKG3RR5LLS4T52YX7GCCIVGQ2465FGEM3SYK7OXUT7FDIKO5PDRC3QC2IRK2KKOJV2QZXZUL727RCLFSHNS4AAAAMOKRPC6OQAAAAACMH6T7WGPZHD2YX; unpl=JF8EAKpnNSttXhtQVxwGSxQVSVtdWw0IHx4EbG8BUQ1RG1BQElcSFBh7XlVdWBRKFR9vbhRVVVNPUw4aASsSEHteVV1ZDUsQAWhiNWRdWUpUBBwLGBsSe15Ublw4SxAEZmYCXFxRQ1UGEwccFxJOXldWXzhKJwNnYDVkbVl7VwYfBx8iEEteVFpcCEoWAG1iNR8zWQZUAhwLGhUYSlRcX14AThAGbWIGV1Vae1U1GA; pinId=9zvM1MUZPR30TcKyARJfCQ; whwswswws=; TrackID=1twlEWek8fMYtiInp2iPT1002ewcBb_CJTu1HCG05s9caLjqP09ma-JepJNGa7W9jEi2kjjq1TvvZzvPheOGGCJwFZ32Bl20UbvdWWswXzVTEO0lTliP1NNBjJ0eQO3FL; ipLoc-djd=12-904-3376-57873.6751590348; pin=15951003078_p; unick=%E5%86%A5%E7%8E%8B%E4%B9%8B%E6%AD%8C; _tp=ak3bQDgGku8%2BskP5GCRaiw%3D%3D; _pst=15951003078_p; warehistory="10084544825151,100066921033,100088587403,100066930469,100066921033,10024782385098,100088849495,10085827003737,100064695864,100064695864,10081479480401,10081479480401,100066206148,10086397575079,10091517815466,100068431529,100058134266,100035340746,"; __jdv=181111935%7Ckong%7Ct_2025416364_%7Cjingfen%7C7a5c65a743784a1e862954a8a5d8d879%7C1710726960310; areaId=12; user-key=94c477b0-9a67-4d77-86be-434d3dfb3391; cn=93; ipLocation=%u6c5f%u82cf; thor=BF80140138890A11F2001240DE13FB3F3C61C0880504BFA8A1E9BDE57F39C6540AD853385176AF4856A76FD9AFAE04919C3BDD7757C832583BF7F4505B228079B675640782AFB306B0A0126FE71C74D2BB3B62FF02610EF086E1845B8567DDBBC722349A3EB5363B2DD1F59089DDAAA25F335E0E59C02B9FCE60FC2803C2B9CCAF4103531ACCF0F506015FD2D5F77401; flash=2_hHBiE7y8DuMk-tT4OeAeMOHvhfCKnfd1mGYI3lxokbKSXx_15Lt2QBNbOAUi0UJXvfWdR9nY7VgHECwpCMV0mXnF4QU98_5k3u81hGGdfNK*; autoOpenApp_downCloseDate_auto=1710209202092_1800000; TARGET_UNIT=bjcenter; ceshi3.com=201; __jdc=70901841; JSESSIONID=388F37AE2F221DD82B286A26FA27D66A.s1; __jdb=70901841.4.1668069089029464342293|279.1710812442; _gia_d=1; PCSYCityID=CN_320000_320100_0; jsavif=1; token=bda0947cbcc973e9ea38c3a3e906829b,3,950451; __tk=ab1b8132881f332a20060502f1186cd6,3,950451; joyya=1710812459.1710812467.30.0ny9gci; joyytokem=babel_3Mj3aSzeiRVGiV4HptYgFJvee5xAMDFVS0pIQzk5MQ==.ZHx7eHtkeX59emJ6ejYGOQ8TJnUnGTMwPWRnfGRyeXo0ej1kNQgJMw0ufBgFAh1nPAJgIBwrKzAaOyoTPBpyBhQ+BHwGIBcyOgAvYn4ScTsfegcgMCc5JQdxKzU=.0d3de8b2; 3AB9D23F7A4B3C9B=7XZ4KFNKG3RR5LLS4T52YX7GCCIVGQ2465FGEM3SYK7OXUT7FDIKO5PDRC3QC2IRK2KKOJV2QZXZUL727RCLFSHNS4',
    'Sec-Fetch-Dest': 'empty',
    'Sec-Fetch-Mode': 'cors',
    'Sec-Fetch-Site': 'same-site',
    # Requests doesn't support trailers
    # 'TE': 'trailers',
}
params = {
    'functionId': 'newBabelAwardCollection',
}

data = 'body=%7B%22activityId%22%3A%223Mj3aSzeiRVGiV4HptYgFJvee5xA%22%2C%22scene%22%3A%221%22%2C%22args%22%3A%22key%3D1D7F4A828F329178D57C633218602E31CF66C809024098D4CF9222CB3AD02773BB3200CFDF58ECE82F19647BA5E6E89C_babel%2CroleId%3D0A779C23406028895E481C11A1AB7113_babel%22%2C%22batchId%22%3A%221114276297%22%2C%22transParam%22%3A%22%7B%5C%22bsessionId%5C%22%3A%5C%226fbb3405-32e4-4f69-87c6-6400a0bbb7a4%5C%22%2C%5C%22babelChannel%5C%22%3A%5C%22%5C%22%2C%5C%22actId%5C%22%3A%5C%2201480316%5C%22%2C%5C%22enActId%5C%22%3A%5C%223Mj3aSzeiRVGiV4HptYgFJvee5xA%5C%22%2C%5C%22pageId%5C%22%3A%5C%224838940%5C%22%2C%5C%22encryptCouponFlag%5C%22%3A%5C%221%5C%22%2C%5C%22requestChannel%5C%22%3A%5C%22pc%5C%22%7D%22%2C%22eid%22%3A%227XZ4KFNKG3RR5LLS4T52YX7GCCIVGQ2465FGEM3SYK7OXUT7FDIKO5PDRC3QC2IRK2KKOJV2QZXZUL727RCLFSHNS4%22%2C%22fp%22%3A%22QDql4V10RkzcM1M3XtKF9C8lQy7Zk5ln%22%2C%22pageClick%22%3A%22Babel_Coupon%22%2C%22floor_id%22%3A%22189036955%22%2C%22mitemAddrId%22%3A%22%22%2C%22geo%22%3A%7B%22lng%22%3A%22%22%2C%22lat%22%3A%22%22%7D%2C%22address_id%22%3A%22%22%2C%22log%22%3A%221710817783565~1yrSJKNsC6xMDFVS0pIQzk5MQ%3D%3D.ZHx7eHtkeX59emJ6ejYGOQ8TJnUnGTMwPWRnfGRyeXo0ej1kNQgJMw0ufBgFAh1nPAJgIBwrKzAaOyoTPBpyBhQ%2BBHwGIBcyOgAvYn4ScTsfegcgMCc5JQdxKzU%3D.0d3de8b2~1%2C1~AB3960F5A3D2A61D2474F5F7FF749642951809CD~1gx60ku~C~TBJFWhEKbBJVBB5ochwCBB8CAXwdVh9EFW0dFUdeWhILbBFUBh1gfx8GbhwAA3gcQhxFFR8SUwIcb3ccBAMdBQZ5G1EdQxEcFVQFGmt1GwMCGwEIAhxQG0cSahwTUEFeFQoDBx8SREMTDREBAAEBDwIHAAgBAAEGAwEIAhEcFUdUUxEKFURFQ1VWUUVXFR8SQFVQFQkSUVZFQ0ZEQlETGxFAU14TDWgCABwADwocAhwEGwIcB20dFVlaFQoCGxFTRBILFVUGVVIIUVUIBQdVBlZTVggJUVYGBFQBUlFRUwhXAwFTFRwTWUMSDRJ8VlB5WURUWxEcFUQTDQIHBgAJBgQHDwMEAQYcFVpaFQkSVhIdFVVAVRILFXFxR2hUWR5mYGYcQ3IFXGZSX1ZhRlJhXmIIeWdaeAV%2BVHJIR3tcAAVpDkt6Bn1ZREFCWH8DFR8SWUYTDRFFFRwTWVJGFQoTVBEcFUNSRREKbAEBDwMcBgkDB24cFUJeFQlrFVETGxFRFRwTVhEcFVETGxFRFRwTVhEcFVETah8SXl9QFQkSUVZXUVVWQ0QTGxFRXRILFUYSGxJSXhEKFUcCGQYeBRIdFVBWaEYTDREJDhIdFVFUFQoTRVJeU19cCmBmbUFeY2JYFRwTWlkSDWsDGwcFGwFsGxFSW19WFQkSVhIdFV5DUBILFVISSg%3D%3D~0oh79zy%22%2C%22random%22%3A%22SVZqoTQh%22%7D&screen=750*1334&client=wh5&clientVersion=1.0.0&sid=&uuid=&area=&loginType=3&functionId=newBabelAwardCollection&appid=wh5&h5st=20240319110943619%3B9330002742335186%3B35fa0%3Btk03wb8de1d0a18nGfIfwMvn052182ns3wUSncFy-ExKyJWzhAtt6ozn7lOegdKTuaja50HMLYGZsAernxcN3ltq19pw%3B65c410b7ed00c420eaffd70da1a3b648d2b020d5fd8dabf74458c4c24633f697%3B3.1%3B1710817783619%3B76dcb804add1320a126905907ff5ddbfe6354a3d8eb09a6164035064d003aab8fc692dfe38dd729a3446fffe69327914841e2c8b5f9ef0a40b35f9e5d49952c300b2a6e824b97ebf7ceb33f158101b5ac5eba469431a907a8b9e4b21d3ae286860abff6085c325b311827b8fa62592786c29b26cda490dfca4bdb57a8e852ba6&eid=7XZ4KFNKG3RR5LLS4T52YX7GCCIVGQ2465FGEM3SYK7OXUT7FDIKO5PDRC3QC2IRK2KKOJV2QZXZUL727RCLFSHNS4&x-api-eid-token=jdd037XZ4KFNKG3RR5LLS4T52YX7GCCIVGQ2465FGEM3SYK7OXUT7FDIKO5PDRC3QC2IRK2KKOJV2QZXZUL727RCLFSHNS4AAAAMOKRPC6OQAAAAACMH6T7WGPZHD2YX'
def send_request():
    res = requests.post('https://api.m.jd.com/client.action', params=params, cookies=cookies, headers=headers, data=data)
    print(res.text)
    return res


target_time = datetime.datetime(2024, 3, 19, 11, 59, 59)
time_diff = (target_time - datetime.datetime.now()).total_seconds()
if time_diff > 0:
    time.sleep(time_diff)

result = True

while result:
    response = send_request()
    if response.status_code != 200:
        print('请求失败')
        time.sleep(0.2)
        continue
    if response.text.find('已抢完') != -1:
        print("本场已抢光，下场再来吧")
        exit()
    if response.text.find('您来早了') != -1:
        time.sleep(0.7)
    else:
        print('领取失败, 重新领取')
        time.sleep(0.7)
